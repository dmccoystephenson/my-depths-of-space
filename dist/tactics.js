!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tactics=t():e.tactics=t()}(self,(()=>(()=>{"use strict";var e={d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Start:()=>z,StartMainMenu:()=>_});const a=JSON.parse('[{"name":"tileset","image":null,"filename":"./images/FullTileset.png"}]');var n=null;function o(){return n}let l=null,r=null;var i=0,c="";const f=JSON.parse('{"keyboard":{"moveUp":"ArrowUp","moveDown":"ArrowDown","moveLeft":"ArrowLeft","moveRight":"ArrowRight","attack":" ","select":"Shift","cancel":"Escape"},"gamepad":{"moveUp":"button12","moveDown":"button13","moveLeft":"button14","moveRight":"button15","attack":"button0","select":"button7","cancel":"button1"}}');var s=!1;function d(e){y(e,!1),m[e]&&m[e](e)}function g(e,t){return e=e.toLowerCase(),f[e][t]}var u={},m={},h=["keyboard","gamepad"];function y(e,t){u[e]=t}function x(e){if(!s)return;let t=Object.keys(f.keyboard);for(let a in t)e.key===f.keyboard[t[a]]&&y(t[a],!0)}function p(e){if(!s)return;console.log(e);let t=Object.keys(f.keyboard);for(let a in t)e.key===f.keyboard[t[a]]&&d(t[a])}u={},m={},h.includes("keyboard")&&(window.removeEventListener("keydown",x),window.removeEventListener("keyup",p),window.addEventListener("keydown",x),window.addEventListener("keyup",p)),h.includes("gamepad")&&gameControl.on("connect",(function(e){let t=Object.keys(f.gamepad);for(let a in t)e.on(f.gamepad[t[a]],(()=>{})).after(f.gamepad[t[a]],(()=>{d(t[a])}))})),s=!1;const w={listen:()=>{s=!0},unlisten:()=>{s=!1},released:(e,t)=>{m[e]=t}};let v=null,b=null;var $=[],k="",S="gamepad",P=5,I=0,E=0,M=0;let C=0,F=0;function T(e){if("Settings"===e)$=[{text:"Difficulty",value:"Easy",action:e=>{e.value="Easy"===e.value?"Hard":"Easy"}},{text:"Controls",value:"",action:e=>{T("Controls")}},{text:"Back",value:"",action:e=>{T()}}],k="Difficulty",C=70,F=60;else if("Controls"===e){$=[{text:"Input Type",value:S.slice(0,1).toUpperCase()+S.slice(1),action:t=>{S="gamepad"===t.value.toLowerCase()?"Keyboard":"Gamepad",T(e)}}];let a=(t=(t=S).toLowerCase(),Object.keys(f[t]));for(let e in a)console.log(a[e],g(S,a[e])),$.push({text:a[e],value:g(S,a[e]),action:e=>{console.log("listen for keypress")}});$.push({text:"Back",value:"",action:()=>{T("Settings")}}),k="Input Type",C=70,F=20}else"Character"===e?($=[{text:`Soul Shards: ${P}`,value:"",action:e=>{}},{text:"+1 Melee",value:M.toString(),action:e=>{P>0&&(P--,M++,T("Character"))}},{text:"+1 Ranged",value:I.toString(),action:e=>{P>0&&(P--,I++,T("Character"))}},{text:"+1 Area",value:E.toString(),action:e=>{P>0&&(P--,E++,T("Character"))}},{text:"Begin",value:"",action:()=>z(M,I,E)}]).findIndex((e=>e.text===k))<0&&(k="+1 Melee"):($=[{text:"Start",value:"",action:e=>{T("Character")}},{text:"Settings",value:"",action:e=>{T("Settings")}},{text:"Credits",value:"",action:e=>{}}],k="Start",C=90,F=40);var t}function A(e){let t=$.findIndex((e=>e.text===k));t+=e,t>$.length-1?t=0:t<0&&(t=$.length-1),k=$[t].text}function D(){return $.filter((e=>e.text===k))[0]}let j={};function O(e,t){j[e]=t}var L=Date.now(),R=Date.now(),U=16,H="mainMenu";function B(){(L=Date.now())-R>=U&&("mainMenu"===H?(b||(b=o()),b.clearRect(0,0,240,160),v||(v=new imui.ImUI(b.canvas),v.font=font,v.onUpdate=e=>{let t=F+30;for(let a in $){let n=$[a].text,o="";$[a].value.length>0&&(o=$[a].value),e.Element({id:"lblMenu"+n,text:`${k===n?">":" "}${n}${k===n?"<":" "}${o.length>0?`     ${o}`:""}`,rect:{x:C,y:t,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),t+=12}}),v.Draw(),function(e,t,o,l){let r=a.filter((e=>"title"===e.name));r.length>0&&n.drawImage(r[0].image,68,10)}()):"main"===H&&function(e){r||(r=o()),r.clearRect(0,0,240,160),r.save(),r.translate(120-Player().x*TileSizes().x,80-Player().y*TileSizes().y),DrawFOV(Player()),Player().draw();let t=getSpriteObjects();for(let e in t)t[e].update(16),t[e].draw();r.restore(),l||(l=new imui.ImUI(r.canvas),l.font=font,l.onUpdate=e=>{if(getTargets().length>0){let e=getSelectedTarget().hp/getSelectedTarget().maxhp,t="It is in perfect health."+getSelectedTarget().state;switch(e<.05?t="It is near death.":e<.3?t="It is gravely injured.":e<.6?t="It is hurt.":e<.85?t="It is bruised.":e<1&&(t="It is scratched."),i){case 0:c=`Melee attack against ${getSelectedTarget().name}.\n${t}`;break;case 1:c=`Ranged attack against ${getSelectedTarget().name}.\n${t}`;break;case 2:c=`Area attack against ${getSelectedTarget().name}.\n${t}`}}else{let e=CalculateDamage(Player(),i);switch(i){case 0:c=`Melee attack (${Player().slots[0]}/16 shards)\nMin/Avg/Max: ${e.min.toFixed(2)}/${e.avg.toFixed(2)}/${e.max.toFixed(2)}`;break;case 1:c=`Ranged attack (${Player().slots[1]}/16 shards)\nMin/Avg/Max: ${e.min.toFixed(2)}/${e.avg.toFixed(2)}/${e.max.toFixed(2)}`;break;case 2:c=`Area attack (${Player().slots[2]}/16 shards)\nMin/Avg/Max: ${e.min.toFixed(2)}/${e.avg.toFixed(2)}/${e.max.toFixed(2)}`}}e.RemoveElement("tooltip"),e.Element({id:"lblGamename",text:"Grimoire",rect:{x:2,y:0,w:64,h:8},color:"#c10000ff",highlight:"#c10000ff",bgcolor:"#cccccc00",font:nightmare}),e.Element({id:"lblScore",text:`Score: ${Player().score}`,rect:{x:108,y:5,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),e.Element({id:"lblXp",text:`XP: ${Player().xp}`,rect:{x:172,y:5,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),e.Element({id:"lblHp",text:`HP: ${Player().hp}/${Player().maxhp}`,rect:{x:108,y:15,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),e.Element({id:"lblMelee",text:`${0===i?">":" "} Melee ${parseInt(Player().slots[0]/16*100)}%`,rect:{x:0,y:136,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),e.Element({id:"lblRanged",text:`${1===i?">":" "} Ranged ${parseInt(Player().slots[1]/16*100)}%`,rect:{x:0,y:144,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),e.Element({id:"lblArea",text:`${2===i?">":" "} Area ${parseInt(Player().slots[2]/16*100)}%`,rect:{x:0,y:152,w:64,h:8},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"}),c.length>0&&e.Element({id:"tooltip",text:c+`\n${Player().x}, ${Player().y}`,rect:{x:66,y:136,w:194,h:24},wrap:"word",color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"})}),l.Draw()}(),R=L),window.requestAnimationFrame(B)}async function _(){await function(){let e=[];for(let t in a){let n=a[t];e.push(new Promise(((e,t)=>{return(o=n.filename,new Promise(((e,t)=>{let n=new Image;n.onload=t=>{e(n)},n.onerror=e=>{console.error(`Failed to load file ${o}:`,e),t(null)},a.filter((e=>e.filename===o)).length>0?n.src=o:(console.error(`Image definition matching filename ${o} not found.`),t(null))}))).then((t=>{n.image=t,e(t)})).catch((e=>console.error("Failed to load",n.filename,e)));var o})))}return Promise.allSettled(e)}();let e=document.getElementById("maincanvas"),t=e.width/e.height;var o;e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px",window.addEventListener("resize",(()=>{e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px"})),T(),U=parseInt(1e3/60),o=e.getContext("2d"),n=o,w.listen(),w.released("moveUp",(e=>{A(-1)})),w.released("moveDown",(e=>{A(1)})),w.released("attack",(e=>{D().action(D())})),window.requestAnimationFrame(B)}async function z(e,t,a){var n;w.unlisten(),n=bestiary.dictionary,j=n,LoadCombatBonusTable(),O("dirt_floors",["floor","floor_dirt"]),O("grimoire",grimoire);let o=await Digger(30,30);Init(CreatePlayer("@",o.Floors())),Player().slots=[e,t,a],AddTemples(3),H="main"}return t})()));
//# sourceMappingURL=tactics.js.map