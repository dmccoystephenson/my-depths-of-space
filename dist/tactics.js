!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tactics=t():e.tactics=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Start:()=>J,StartMainMenu:()=>F});const n=JSON.parse('[{"name":"tileset","image":null,"filename":"./images/FullTileset.png"}]');var i=null;function l(){return i}let r=null,a=null,o="";const c=JSON.parse('{"d":{"moveUp":"ArrowUp","moveDown":"ArrowDown","moveLeft":"ArrowLeft","moveRight":"ArrowRight","attack":" ","select":"Shift","cancel":"Escape"},"v":{"moveUp":"button12","moveDown":"button13","moveLeft":"button14","moveRight":"button15","attack":"button0","select":"button7","cancel":"button1"}}');var d=!1;function s(e){p(e,!1),u[e]&&u[e](e)}var f={},u={},h=["keyboard","gamepad"];function p(e,t){f[e]=t}function m(e){if(!d)return;let t=Object.keys(c.d);for(let n in t)e.key===c.d[t[n]]&&p(t[n],!0)}function S(e){if(!d)return;console.log(e);let t=Object.keys(c.d);for(let n in t)e.key===c.d[t[n]]&&s(t[n])}f={},u={},h.includes("keyboard")&&(window.removeEventListener("keydown",m),window.removeEventListener("keyup",S),window.addEventListener("keydown",m),window.addEventListener("keyup",S)),h.includes("gamepad")&&gameControl.on("connect",(function(e){let t=Object.keys(c.v);for(let n in t)e.on(c.v[t[n]],(()=>{})).after(c.v[t[n]],(()=>{s(t[n])}))})),d=!1;const b={listen:()=>{d=!0},unlisten:()=>{d=!1},released:(e,t)=>{u[e]=t}},w=JSON.parse('[{"id":"Main","Style":{"Color":"#c1c1c1ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff"},"Options":[{"text":"Start","onSelect":"menu_GameSetup","width":"90%"},{"text":"Settings","onSelect":"menu_Settings","width":"90%"},{"text":"Credits","onSelect":"menu_Credits","width":"90%"}]},{"id":"GameSetup","Style":{"Color":"#a0a0a0ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff"},"Options":[{"text":"Hire Squad ({0} hired)","onRender":"callback_OnRenderHireSquad","width":"90%"},{"text":"Stars: {0}","onRender":"callback_OnRenderStars","width":"90%"},{"text":"Overseer (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Trooper (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Artillerist (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Recon (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Technician (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Medic (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Herald (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Crusader (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Bastion (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Next","onSelect":"callback_SetupEquipment","width":"90%"}]},{"id":"SetupEquipment","Style":{"Color":"#a0a0a0ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff"},"Options":[{"text":"Squad Equipment","width":"90%"},{"text":"Next","onSelect":"menu_SetupEquipment","width":"90%"}]},{"id":"Settings","onLoad":"callback_StartSettings","Options":[{"text":"Input Type","width":"90%"}]}]'),k=JSON.parse('[{"name":"Overseer","Cost":4,"equipAbilities":6,"gunnerySkill":5,"meleeSkill":5,"speed":4,"hp":22},{"name":"Trooper","Cost":1,"equipAbilities":4,"gunnerySkill":5,"meleeSkill":6,"speed":4,"hp":16},{"name":"Artillerist","Cost":3,"equipAbilities":5,"gunnerySkill":4,"meleeSkill":7,"speed":3,"hp":18},{"name":"Recon","Cost":2,"equipAbilities":5,"gunnerySkill":8,"meleeSkill":4,"speed":6,"hp":16},{"name":"Technician","Cost":2,"equipAbilities":7,"gunnerySkill":7,"meleeSkill":8,"speed":3,"hp":14},{"name":"Medic","Cost":4,"equipAbilities":7,"gunnerySkill":6,"meleeSkill":7,"speed":4,"hp":20},{"name":"Herald","Cost":3,"equipAbilities":8,"gunnerySkill":8,"meleeSkill":6,"speed":4,"hp":14},{"name":"Crusader","Cost":5,"equipAbilities":7,"gunnerySkill":6,"meleeSkill":5,"speed":5,"hp":25},{"name":"Bastion","Cost":3,"equipAbilities":5,"gunnerySkill":6,"meleeSkill":4,"speed":3,"hp":28}]');class x{constructor(e){try{this.data=k.filter((t=>t.name===e))[0],this.data.maxHp=this.data.hp,this.name=this.data.name}catch{this.data={},console.error(`Could not locate template for ${e}.`)}this.effectModifiers={},this.effects=[]}UpdateEffects(){for(let e in this.effects){let t=this.effects[e];t.ttl&&t.ttl--,t.ttl<=0&&this.RemoveEffectModifier(t)}this.effects=this.effects.filter((e=>e.ttl>0))}AddEffect(e){e.ttl&&this.effects.push(e),void 0!==e.attribute&&this.AddEffectModifier(e.attribute,e.amount)}RemoveEffectModifier(e){void 0!==e.attribute&&this.AddEffect(e.attribute,-1*e.amount)}AddEffectModifier(e,t){void 0===this.effectModifiers[e]&&(this.effectModifiers[e]=0),this.effectModifiers[e]+=t}EffectModifier(e){return void 0!==this.effectModifiers[e]?this.effectModifiers[e]:0}Name(){return this.data.name}Cost(){return this.data.Cost+this.EffectModifier("cost")}EquipmentAndAbilities(){return this.data.equipAbilities+this.EffectModifier("equipAbilities")}GunnerySkill(){return this.data.gunnerySkill+this.EffectModifier("gunnerySkill")}MeleeSkill(){return this.data.meleeSkill+this.EffectModifier("meleeSkill")}Speed(){return this.data.speed+this.EffectModifier("speed")}Hp(){return this.data.hp+this.EffectModifier("hp")}MaxHp(){return this.data.maxHp+this.EffectModifier("maxHp")}}let g=null,y=null;var C=16,v=[],O=null,_=[],R={},E="Main",M="Start",q={callback_OnRenderStars:(e,t)=>[C.toString()],callback_OnRenderHireSquad:(e,t)=>[v.length],callback_OnRenderCharacter:(e,t)=>{let n=e.split(" ")[0].replace(">","");return[v.filter((e=>e.name===n)).length]},callback_HireCharacter:e=>{let t=e.split(" ")[0].replace(">",""),n=new x(t);C-n.Cost()>=0&&(v.push(n),C-=n.Cost())},callback_SelectCharacterEquip:e=>{console.log("character equip",e)},callback_SetupEquipment:e=>{let t=w.filter((e=>"SetupEquipment"===e.id))[0],n=t.Options.findIndex((e=>"Next"===e.text));t.Options=[t.Options[0],...v.map((e=>({text:e.name,onSelect:"callback_SelectCharacterEquip",width:"90%"}))),t.Options[n]],j("SetupEquipment")}};let A=0,H=0;function I(e){return e.includes("callback_")?q[e]?q[e]:()=>{}:(e.includes("menu_")&&j(e.split("_")[1]),()=>{})}function j(e){b.unlisten();let t=D(E=e).Options.filter((e=>e.onSelect));M=t[0].text,R=t.filter((e=>e.text===M))[0],b.listen()}function D(e){try{return w.filter((t=>t.id===e))[0]}catch{return null}}function L(e,t){let n=e.split(/{[0-9]}/),i=[];for(let e in n)i.push(`{${e}}`);let l=I(t)(e,n);for(let t in l)e=e.replace(i[t],l[t]);return e}var T=Date.now(),U=Date.now(),N=16,P="mainMenu";function $(){(T=Date.now())-U>=N&&("mainMenu"===P?(y||(y=l()),y.clearRect(0,0,320,200),g||(g=new imui.ImUI(y.canvas),g.font=font,g.onUpdate=e=>{let t=D(E),n=t.Options;g.RemoveElements();let i=H+30;for(let l in n){let r=n[l].text,a=n[l],o=r===M?t.Style.SelectColor:a.onSelect?t.Style.SelectableColor:t.Style.Color,c=`${M===r?">":" "}${r}${M===r?"<":" "}`;c.includes("{")&&c.includes("}")&&a.onRender&&(c=L(c,a.onRender)),e.Element({id:"lblMenu"+E+r,text:c,rect:{x:A,y:i,w:64,h:8},color:o,highlight:o,bgcolor:"#cccccc00"}),i+=12}}),g.Draw()):"main"===P&&(a||(a=l()),a.clearRect(0,0,320,200),r||(r=new imui.ImUI(a.canvas),r.font=font,r.onUpdate=e=>{e.Element({id:"lblTooltip",text:o,rect:{x:0,y:0,w:240,h:10},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"})}),r.Draw()),U=T),window.requestAnimationFrame($)}async function F(){await function(){let e=[];for(let t in n){let i=n[t];e.push(new Promise(((e,t)=>{return(l=i.filename,new Promise(((e,t)=>{let i=new Image;i.onload=t=>{e(i)},i.onerror=e=>{console.error(`Failed to load file ${l}:`,e),t(null)},n.filter((e=>e.filename===l)).length>0?i.src=l:(console.error(`Image definition matching filename ${l} not found.`),t(null))}))).then((t=>{i.image=t,e(t)})).catch((e=>console.error("Failed to load",i.filename,e)));var l})))}return Promise.allSettled(e)}();let e=document.getElementById("maincanvas"),t=e.width/e.height;var l;e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px",window.addEventListener("resize",(()=>{e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px"})),N=parseInt(1e3/60),l=e.getContext("2d"),i=l,b.listen(),b.released("moveDown",(()=>{O=D(E),_=O.Options.filter((e=>e.onSelect)),R=_.filter((e=>e.text===M))[0];let e=_.findIndex((e=>e.text===M));e++,e>=_.length&&(e=0),M=_[e].text})),b.released("moveUp",(()=>{O=D(E),_=O.Options.filter((e=>e.onSelect)),R=_.filter((e=>e.text===M))[0];let e=_.findIndex((e=>e.text===M));e--,e<0&&(e=_.length-1),M=_[e].text})),b.released("attack",(()=>{O=D(E),_=O.Options.filter((e=>e.onSelect)),(R=_.filter((e=>e.text===M))[0]).onSelect&&I(R.onSelect)(R.text)})),window.requestAnimationFrame($)}async function J(){b.unlisten(),P="main"}return t})()));
//# sourceMappingURL=tactics.js.map