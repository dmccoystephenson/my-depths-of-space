!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tactics=t():e.tactics=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Start:()=>T,StartMainMenu:()=>F});const n=JSON.parse('[{"name":"tileset","image":null,"filename":"./images/FullTileset.png"}]');var o=null;function l(){return o}let i=null,r=null,c="";const a=JSON.parse('{"d":{"moveUp":"ArrowUp","moveDown":"ArrowDown","moveLeft":"ArrowLeft","moveRight":"ArrowRight","attack":" ","select":"Shift","cancel":"Escape"},"v":{"moveUp":"button12","moveDown":"button13","moveLeft":"button14","moveRight":"button15","attack":"button0","select":"button7","cancel":"button1"}}');var d=!1;function f(e){w(e,!1),u[e]&&u[e](e)}var s={},u={},m=["keyboard","gamepad"];function w(e,t){s[e]=t}function S(e){if(!d)return;let t=Object.keys(a.d);for(let n in t)e.key===a.d[t[n]]&&w(t[n],!0)}function p(e){if(!d)return;console.log(e);let t=Object.keys(a.d);for(let n in t)e.key===a.d[t[n]]&&f(t[n])}s={},u={},m.includes("keyboard")&&(window.removeEventListener("keydown",S),window.removeEventListener("keyup",p),window.addEventListener("keydown",S),window.addEventListener("keyup",p)),m.includes("gamepad")&&gameControl.on("connect",(function(e){let t=Object.keys(a.v);for(let n in t)e.on(a.v[t[n]],(()=>{})).after(a.v[t[n]],(()=>{f(t[n])}))})),d=!1;const g={listen:()=>{d=!0},unlisten:()=>{d=!1},released:(e,t)=>{u[e]=t}},h=JSON.parse('[{"id":"Main","Style":{"Color":"#c1c1c1ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff"},"Options":[{"text":"Start","onSelect":"menu_GameSetup","width":"90%"},{"text":"Settings","onSelect":"menu_Settings","width":"90%"},{"text":"Credits","onSelect":"menu_Credits","width":"90%"}]},{"id":"GameSetup","Style":{"Color":"#c1c1c1ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff"},"Options":[{"text":"Stars: {0}","onRender":"callback_OnRenderStars","width":"90%"},{"text":"- Star","onSelect":"callback_StarDown","width":"90%"},{"text":"+ Star","onSelect":"callback_StarUp","width":"90%"}]},{"id":"Settings","onLoad":"callback_StartSettings","Options":[{"text":"Input Type","width":"90%"}]}]');let y=null,b=null;var v=16,x=null,k=[],O={},_="Main",C="Start",D={callback_OnRenderStars:(e,t)=>[v.toString()],callback_StarUp:()=>{v++,console.log("stars",v)},callback_StarDown:()=>{v--,console.log("stars",v)}};let I=0,j=0;function R(e){if(e.includes("callback_"))return D[e];if(e.includes("menu_")){let t=e.split("_"),n=U(_=t[1]).Options.filter((e=>e.onSelect));C=n[0].text,O=n.filter((e=>e.text===C))[0],console.log(_,C)}return()=>{}}function U(e){try{return h.filter((t=>t.id===e))[0]}catch{return null}}function E(e,t){let n=e.split(/{[0-9]}/),o=[];for(let e in n)o.push(`{${e}}`);let l=R(t)(e,n);for(let t in l)e=e.replace(o[t],l[t]);return e}var L=Date.now(),M=Date.now(),P=16,A="mainMenu";function $(){(L=Date.now())-M>=P&&("mainMenu"===A?(b||(b=l()),b.clearRect(0,0,240,160),y||(y=new imui.ImUI(b.canvas),y.font=font,y.onUpdate=e=>{let t=U(_),n=t.Options,o=j+30;for(let l in n){let i=n[l].text,r=n[l],c=i===C?t.Style.SelectColor:r.onSelect?t.Style.SelectableColor:t.Style.Color,a=`${C===i?">":" "}${i}${C===i?"<":" "}`;a.includes("{")&&a.includes("}")&&r.onRender&&(a=E(a,r.onRender)),e.Element({id:"lblMenu"+_+i,text:a,rect:{x:I,y:o,w:64,h:8},color:c,highlight:c,bgcolor:"#cccccc00"}),o+=12}}),y.Draw()):"main"===A&&(r||(r=l()),r.clearRect(0,0,240,160),i||(i=new imui.ImUI(r.canvas),i.font=font,i.onUpdate=e=>{e.Element({id:"lblTooltip",text:c,rect:{x:0,y:0,w:240,h:10},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"})}),i.Draw()),M=L),window.requestAnimationFrame($)}async function F(){await function(){let e=[];for(let t in n){let o=n[t];e.push(new Promise(((e,t)=>{return(l=o.filename,new Promise(((e,t)=>{let o=new Image;o.onload=t=>{e(o)},o.onerror=e=>{console.error(`Failed to load file ${l}:`,e),t(null)},n.filter((e=>e.filename===l)).length>0?o.src=l:(console.error(`Image definition matching filename ${l} not found.`),t(null))}))).then((t=>{o.image=t,e(t)})).catch((e=>console.error("Failed to load",o.filename,e)));var l})))}return Promise.allSettled(e)}();let e=document.getElementById("maincanvas"),t=e.width/e.height;var l;e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px",window.addEventListener("resize",(()=>{e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px"})),P=parseInt(1e3/60),l=e.getContext("2d"),o=l,g.listen(),x=U(_),k=x.Options.filter((e=>e.onSelect)),O=k.filter((e=>e.text===C))[0],g.released("moveDown",(()=>{let e=k.findIndex((e=>e.text===C));e++,e>=k.length&&(e=0),C=k[e].text})),g.released("moveUp",(()=>{let e=k.findIndex((e=>e.text===C));e--,e<0&&(e=k.length-1),C=k[e].text})),g.released("attack",(()=>{O.onSelect&&(console.log(O.onSelect,R(O.onSelect)),R(O.onSelect)())})),window.requestAnimationFrame($)}async function T(){g.unlisten(),A="main"}return t})()));
//# sourceMappingURL=tactics.js.map