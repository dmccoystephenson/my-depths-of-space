{"version":3,"file":"tactics.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAiB,QAAID,IAErBD,EAAc,QAAIC,GACnB,CATD,CASGK,MAAM,I,mBCRT,IAAIC,EAAsB,CCA1BA,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBL,IACH,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,GAAO,G,mJCH9D,IAAIC,EAAM,KAMV,SAASC,IACL,OAAOD,CACX,CCRA,IAAIE,EAAM,KAEN,EAAM,KAENC,EAAU,G,8TCJd,IAAIC,GAAY,EAMhB,SAASC,EAAiBC,GACxBC,EAASD,GAAQ,GACbE,EAAUF,IACZE,EAAUF,GAAQA,EAEtB,CAYA,IAAIG,EAAa,CAAC,EACdD,EAAY,CAAC,EAEbE,EAAU,CAAE,WAAY,WAE5B,SAASH,EAASD,EAAQP,GACxBU,EAAWH,GAAUP,CACvB,CASA,SAASY,EAAgBC,GACvB,IAAKR,EACH,OAEF,IAAIS,EAASzB,OAAO0B,KAAK,KACzB,IAAK,IAAIC,KAAKF,EACRD,EAAE1B,MAAQ,IAAc2B,EAAOE,KA1CrCR,EA2CmBM,EAAOE,IA3CT,EA8CnB,CAEA,SAASC,EAAcJ,GACrB,IAAKR,EACH,OAEFa,QAAQC,IAAIN,GACZ,IAAIC,EAASzB,OAAO0B,KAAK,KACzB,IAAK,IAAIC,KAAKF,EACRD,EAAE1B,MAAQ,IAAc2B,EAAOE,KACjCV,EAAgBQ,EAAOE,GAG7B,CAGEN,EAAa,CAAC,EACdD,EAAY,CAAC,EACTE,EAAQS,SAAS,cACnBC,OAAOC,oBAAoB,UAAWV,GACtCS,OAAOC,oBAAoB,QAASL,GACpCI,OAAOE,iBAAiB,UAAWX,GACnCS,OAAOE,iBAAiB,QAASN,IAE/BN,EAAQS,SAAS,YACnBI,YAAYC,GAAG,WAAW,SAASC,GACjC,IAAIZ,EAASzB,OAAO0B,KAAK,KACzB,IAAK,IAAIC,KAAKF,EACZY,EAAQD,GAAG,IAAaX,EAAOE,KAAK,SAEjCW,MAAM,IAAab,EAAOE,KAAK,KAChCV,EAAgBQ,EAAOE,GAAE,GAG/B,IAEFX,GAAY,EAiBd,QAZY,CACVuB,OAAQ,KACNvB,GAAY,GAEdwB,SAAU,KACRxB,GAAY,GAEdyB,SAAU,CAACvB,EAAQwB,KACjBtB,EAAUF,GAAUwB,I,02FChGxB,MAAMC,EACFC,YAAYC,GAER,IACIC,KAAKC,KAAO,UAAkBC,GAAKA,EAAEH,OAASA,IAAM,GACpDC,KAAKC,KAAKE,MAAQH,KAAKC,KAAKG,GAC5BJ,KAAKD,KAAOC,KAAKC,KAAKF,IAC1B,CAAE,MACEC,KAAKC,KAAO,CAAC,EACblB,QAAQsB,MAAM,iCAAiCN,KACnD,CAGAC,KAAKM,gBAAkB,CAAC,EAIxBN,KAAKO,QAAU,EACnB,CAMAC,gBACI,IAAK,IAAI9B,KAAKsB,KAAKO,QAAS,CACxB,IAAIE,EAAST,KAAKO,QAAQ7B,GACtB+B,EAAOC,KACPD,EAAOC,MAEPD,EAAOC,KAAO,GACdV,KAAKW,qBAAqBF,EAElC,CACAT,KAAKO,QAAUP,KAAKO,QAAQK,QAAOV,GAAKA,EAAEQ,IAAM,GACpD,CAEAG,UAAUJ,GACFA,EAAOC,KACPV,KAAKO,QAAQO,KAAKL,QAEGM,IAArBN,EAAOO,WACPhB,KAAKiB,kBAAkBR,EAAOO,UAAWP,EAAOS,OAExD,CACAP,qBAAqBF,QACQM,IAArBN,EAAOO,WACPhB,KAAKa,UAAUJ,EAAOO,WAA4B,EAAjBP,EAAOS,OAEhD,CAEAD,kBAAkBD,EAAWE,QACeH,IAApCf,KAAKM,gBAAgBU,KACrBhB,KAAKM,gBAAgBU,GAAa,GAEtChB,KAAKM,gBAAgBU,IAAcE,CACvC,CAEAC,eAAeH,GACX,YAAwCD,IAApCf,KAAKM,gBAAgBU,GACdhB,KAAKM,gBAAgBU,GAEzB,CACX,CAEAI,OACI,OAAOpB,KAAKC,KAAKF,IACrB,CAEAsB,OACI,OAAOrB,KAAKC,KAAKoB,KAAOrB,KAAKmB,eAAe,OAChD,CAEAG,wBACI,OAAOtB,KAAKC,KAAKsB,eAAiBvB,KAAKmB,eAAe,iBAC1D,CAEAK,eACI,OAAOxB,KAAKC,KAAKwB,aAAezB,KAAKmB,eAAe,eACxD,CAEAO,aACI,OAAO1B,KAAKC,KAAK0B,WAAa3B,KAAKmB,eAAe,aACtD,CAEAS,QACI,OAAO5B,KAAKC,KAAK4B,MAAQ7B,KAAKmB,eAAe,QACjD,CAEAW,KACI,OAAO9B,KAAKC,KAAKG,GAAKJ,KAAKmB,eAAe,KAC9C,CAEAY,QACI,OAAO/B,KAAKC,KAAKE,MAAQH,KAAKmB,eAAe,QACjD,EC7FJ,IAAI,EAAM,KAEN,EAAM,KAEV,IAAIa,EAAQ,GAERC,EAAQ,GAERC,EAAO,KACPC,EAAY,GACZC,EAAW,CAAC,EACZC,EAAgB,OAChBC,EAAkB,QAClBC,EAAc,CACdC,uBAAwB,CAACC,EAAMC,IACpB,CAACV,EAAMW,YAElBC,2BAA4B,CAACH,EAAMC,IACxB,CAACT,EAAMY,QAGlBC,2BAA4B,CAACL,EAAMC,KAC/B,IAAI3C,EAAO0C,EAAKM,MAAM,KAAK,GAAGC,QAAQ,IAAK,IAC3C,MAAO,CAAEf,EAAMrB,QAAOV,GAAKA,EAAEH,OAASA,IAAY,OAAC,EAGvDkD,uBAAyBR,IACrB,IAAI1C,EAAO0C,EAAKM,MAAM,KAAK,GAAGC,QAAQ,IAAK,IACvCE,EAAO,IAAIrD,EAAUE,GACrBiC,EAAQkB,EAAK7B,QAAU,IACvBY,EAAMnB,KAAKoC,GACXlB,GAASkB,EAAK7B,OAClB,EAGJ8B,8BAAgCV,IAC5B1D,QAAQC,IAAI,kBAAmByD,EAAI,EAGvCW,wBAA0BX,IACtB,IAAIP,EAAO,UAAahC,GAAc,mBAATA,EAAEmD,KAAyB,GACpDC,EAAYpB,EAAKqB,QAAQC,WAAUtD,GAAgB,SAAXA,EAAEuC,OAC9CP,EAAKqB,QAAU,CACXrB,EAAKqB,QAAQ,MACVtB,EAAMwB,KAAIC,IACN,CACHjB,KAAMiB,EAAE3D,KACR4D,SAAU,gCACVC,MAAO,UAEX1B,EAAKqB,QAAQD,IAEjBO,EAAW,iBAAgB,GAInC,IAAIC,EAAS,EACTC,EAAS,EAEb,SAASC,EAAOC,GACZ,OAAIA,EAAShF,SAAS,aACXsD,EAAY0B,GAAY1B,EAAY0B,GAAY,QAChDA,EAAShF,SAAS,UAEzB4E,EADaI,EAASlB,MAAM,KACV,IAEf,OACX,CAEA,SAASc,EAAWR,GAChB,aAEA,IACIlB,EADO+B,EADX7B,EAAgBgB,GAEKE,QAAQ3C,QAAOV,GAAKA,EAAEyD,WAC3CrB,EAAkBH,EAAU,GAAGM,KAC/BL,EAAWD,EAAUvB,QAAOV,GAAKA,EAAEuC,OAASH,IAAiB,GAC7D,UACJ,CAEA,SAAS4B,EAAQb,GACb,IACI,OAAO,UAAanD,GAAKA,EAAEmD,KAAOA,IAAI,EAC1C,CAAE,MAAQ,OAAO,IAAK,CAC1B,CA8CA,SAASc,EAAS1B,EAAM2B,GACpB,IAAIC,EAAM5B,EAAKM,MAAM,WACjBL,EAAe,GACnB,IAAK,IAAI4B,KAAKD,EACV3B,EAAa5B,KAAK,IAAIwD,MAE1B,IAAIC,EAASP,EAAOI,EAAPJ,CAAiBvB,EAAM4B,GACpC,IAAK,IAAIG,KAAKD,EACV9B,EAAOA,EAAKO,QAAQN,EAAa8B,GAAID,EAAOC,IAEhD,OAAO/B,CACX,CCxIA,IAAIgC,EAAUC,KAAKC,MACfC,EAAWF,KAAKC,MAEhBE,EAAc,GAEdC,EAAe,WAMnB,SAASC,KACLN,EAAUC,KAAKC,OACOC,GACTC,IAYQ,aAAjBC,GD2FC,IACD,EAAM/G,KAEV,EAAIiH,UAAU,EAAG,EAAG,IAAK,KAmBpB,IACD,EAAM,IAAIC,KAAKC,KAAK,EAAIC,QACxB,EAAIC,KAAOA,KAEX,EAAIC,SAAYC,IAEZ,IAAIpD,EAAOgC,EAAQ7B,GACfF,EAAYD,EAAKqB,QACrB,EAAIgC,iBACJ,IAAIC,EAAKzB,EAAS,GAClB,IAAK,IAAIlF,KAAKsD,EAAW,CACrB,IAAIsD,EAAOtD,EAAUtD,GAAG4D,KACpBL,EAAWD,EAAUtD,GACrB6G,EAAOD,IAASnD,EAAkBJ,EAAKyD,MAAMC,YAAcxD,EAASuB,SAAWzB,EAAKyD,MAAME,gBAAkB3D,EAAKyD,MAAMG,MACvHC,EAAM,GAAGzD,IAAoBmD,EAAO,IAAM,MAAMA,IAAOnD,IAAoBmD,EAAO,IAAM,MACxFM,EAAI9G,SAAS,MAAQ8G,EAAI9G,SAAS,MAAQmD,EAASgC,WACnD2B,EAAM5B,EAAS4B,EAAK3D,EAASgC,WAEjCkB,EAAGU,QAAQ,CAAE3C,GAAI,UAAYhB,EAAgBoD,EAAMhD,KAAMsD,EAAKE,KAAM,CAAEC,EAAGpC,EAAQqC,EAAGX,EAAIY,EAAG,GAAIC,EAAG,GAAKC,MAAOZ,EAAMa,UAAWb,EAAMc,QAAS,cAC9IhB,GAAM,EACV,IAGR,EAAIiB,QCtIwB,SAAjB3B,IJ7BN,IACD,EAAM/G,KAEV,EAAIiH,UAAU,EAAG,EAAG,IAAK,KAkBpBhH,IACDA,EAAM,IAAIiH,KAAKC,KAAK,EAAIC,QACxBnH,EAAIoH,KAAOA,KAEXpH,EAAIqH,SAAYC,IACZA,EAAGU,QAAQ,CAAE3C,GAAI,aAAcZ,KAAMxE,EAASgI,KAAM,CAAEC,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAAKC,EAAG,IAAMC,MAAO,YAAaC,UAAW,YAAaC,QAAS,aAAa,GAG7JxI,EAAIyI,QIZA7B,EAAWH,GAEfvF,OAAO6F,sBAAsBA,EACjC,CAcA2B,eAAeC,ULSf,WACI,IAAIC,EAAW,GACf,IAAK,IAAI/H,KAAK,EAAQ,CAClB,IAAIgI,EAAQ,EAAOhI,GACnB+H,EAAS9F,KAAK,IAAIgG,SAAQ,CAACC,EAASC,KAAWC,OAxBpCC,EAwB8CL,EAAMK,SAvB5D,IAAIJ,SAAQ,CAACC,EAASC,KACzB,IAAIG,EAAM,IAAIC,MACdD,EAAIE,OAAU3I,IACVqI,EAAQI,EAAG,EAEfA,EAAIG,QAAW5I,IACXK,QAAQsB,MAAM,uBAAuB6G,KAAaxI,GAClDsI,EAAO,KAAI,EAEH,UAAc9G,GAAKA,EAAEgH,WAAaA,IACpCrE,OAAS,EACfsE,EAAII,IAAML,GAEVnI,QAAQsB,MAAM,sCAAsC6G,gBACpDF,EAAO,MACX,KAQyEQ,MAAKlD,IAC1EuC,EAAMA,MAAQvC,EACdyC,EAAQzC,EAAC,IACVmD,OAAM/I,GAAKK,QAAQsB,MAAM,iBAAkBwG,EAAMK,SAAUxI,KA3BtE,IAAmBwI,CA2BsD,IACrE,CACA,OAAOJ,QAAQY,WAAWd,EAC9B,CKlBUe,GAEN,IAAIxC,EAASyC,SAASC,eAAe,cACjCC,EAAQ3C,EAAOvB,MAAQuB,EAAO4C,OA9BtC,ILboBC,EK4ChB7C,EAAO8C,MAAMF,OAAS7I,OAAOgJ,YAAc,KAC3C/C,EAAO8C,MAAMrE,MAAQ1E,OAAOgJ,YAAcJ,EAAQ,KAClD5I,OAAOE,iBAAiB,UAAU,KAC9B+F,EAAO8C,MAAMF,OAAS7I,OAAOgJ,YAAc,KAC3C/C,EAAO8C,MAAMrE,MAAQ1E,OAAOgJ,YAAcJ,EAAQ,QAlCtDjD,EAAcsD,SAAS,IAqCJ,ILnDHH,EKoDL7C,EAAOpH,WAAW,MLnD7BD,EAAMkK,EIuFN,WAEA,WAAe,YAAY,KACvB9F,EAAOgC,EAAQ7B,GACfF,EAAYD,EAAKqB,QAAQ3C,QAAOV,GAAKA,EAAEyD,WACvCvB,EAAWD,EAAUvB,QAAOV,GAAKA,EAAEuC,OAASH,IAAiB,GAC7D,IAAI8F,EAAQjG,EAAUqB,WAAUtD,GAAKA,EAAEuC,OAASH,IAChD8F,IACIA,GAASjG,EAAUU,SACnBuF,EAAQ,GAEZ9F,EAAkBH,EAAUiG,GAAO3F,QAEvC,WAAe,UAAU,KACrBP,EAAOgC,EAAQ7B,GACfF,EAAYD,EAAKqB,QAAQ3C,QAAOV,GAAKA,EAAEyD,WACvCvB,EAAWD,EAAUvB,QAAOV,GAAKA,EAAEuC,OAASH,IAAiB,GAC7D,IAAI8F,EAAQjG,EAAUqB,WAAUtD,GAAKA,EAAEuC,OAASH,IAChD8F,IACIA,EAAQ,IACRA,EAAQjG,EAAUU,OAAS,GAE/BP,EAAkBH,EAAUiG,GAAO3F,QAEvC,WAAe,UAAU,KACrBP,EAAOgC,EAAQ7B,GACfF,EAAYD,EAAKqB,QAAQ3C,QAAOV,GAAKA,EAAEyD,YACvCvB,EAAWD,EAAUvB,QAAOV,GAAKA,EAAEuC,OAASH,IAAiB,IAChDqB,UACTK,EAAO5B,EAASuB,SAAhBK,CAA0B5B,EAASK,KACvC,IC9DJvD,OAAO6F,sBAAsBA,EACjC,CAEA2B,eAAe2B,IAEX,aAKAvD,EAAe,MACnB,C","sources":["webpack://tactics/webpack/universalModuleDefinition","webpack://tactics/webpack/bootstrap","webpack://tactics/webpack/runtime/define property getters","webpack://tactics/webpack/runtime/hasOwnProperty shorthand","webpack://tactics/webpack/runtime/make namespace object","webpack://tactics/./src/images.js","webpack://tactics/./src/mainScene.js","webpack://tactics/./src/input.js","webpack://tactics/./src/character.js","webpack://tactics/./src/menuScene.js","webpack://tactics/./src/main.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tactics\"] = factory();\n\telse\n\t\troot[\"tactics\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import images from './images.json'\r\n\r\nvar ctx = null\r\n\r\nfunction setContext(context) {\r\n    ctx = context\r\n}\r\n\r\nfunction getContext() {\r\n    return ctx\r\n}\r\n\r\nfunction getImage(name) {\r\n    let img = images.filter(f => f.name === name)\r\n    return img.length > 0 ? img[0].image : null\r\n}\r\n\r\nfunction getImages() {\r\n    return images\r\n}\r\n\r\nfunction drawImage(name, x, y, srcRect) {\r\n    let img = images.filter(f => f.name === name)\r\n    if (img.length > 0) {\r\n        if (srcRect) {\r\n            ctx.drawImage(img[0].image, srcRect.x, srcRect.y, srcRect.w, srcRect.h, x, y, srcRect.w, srcRect.h)\r\n        } else {\r\n            ctx.drawImage(img[0].image, x, y)\r\n        }\r\n    }\r\n}\r\n\r\nfunction loadImage(filename) {\r\n    return new Promise((resolve, reject) => {\r\n        let img = new Image()\r\n        img.onload = (e) => {\r\n            resolve(img)\r\n        }\r\n        img.onerror = (e) => {\r\n            console.error(`Failed to load file ${filename}:`, e)\r\n            reject(null)\r\n        }\r\n        let image = images.filter(f => f.filename === filename)\r\n        if (image.length > 0) {\r\n            img.src = filename\r\n        } else {\r\n            console.error(`Image definition matching filename ${filename} not found.`)\r\n            reject(null)\r\n        }\r\n    })\r\n}\r\n\r\nfunction loadAllImages() {\r\n    let promises = []\r\n    for (let i in images) {\r\n        let image = images[i]\r\n        promises.push(new Promise((resolve, reject) => loadImage(image.filename).then(r => {\r\n            image.image = r\r\n            resolve(r)\r\n        }).catch(e => console.error('Failed to load', image.filename, e))))\r\n    }\r\n    return Promise.allSettled(promises)\r\n}\r\n\r\nexport { loadAllImages, loadImage, drawImage, getImage, getImages, setContext, getContext }\r\n","import { getContext } from \"./images.js\"\r\n\r\nlet imu = null\r\n\r\nlet ctx = null\r\n\r\nlet tooltip = ''\r\n\r\nfunction drawFrame(delta) {\r\n    if (!ctx) {\r\n        ctx = getContext()\r\n    }\r\n    ctx.clearRect(0, 0, 320, 200)\r\n\r\n    /*ctx.save()\r\n    ctx.translate(120 - Player().x * TileSizes().x, 80 - Player().y * TileSizes().y)\r\n    DrawFOV(Player())\r\n    Player().draw()\r\n    let spriteObjs = getSpriteObjects()\r\n    for (let index in spriteObjs) {\r\n        spriteObjs[index].update(16)\r\n        spriteObjs[index].draw()\r\n    }\r\n\r\n    ctx.restore()*/\r\n\r\n    drawUI()\r\n}\r\n\r\nfunction drawUI(delta) {\r\n    if (!imu) {\r\n        imu = new imui.ImUI(ctx.canvas)\r\n        imu.font = font\r\n\r\n        imu.onUpdate = (ui) => {\r\n            ui.Element({ id: 'lblTooltip', text: tooltip, rect: { x: 0, y: 0, w: 240, h: 10 }, color: '#f1f1f1ff', highlight: '#f1f1f1ff', bgcolor: '#cccccc00' })\r\n        }\r\n    }\r\n    imu.Draw()\r\n}\r\n\r\nexport { drawFrame }","import maps from './keymapping.json'\r\n\r\nvar listening = false\r\n\r\nfunction handlerPressed (button) {\r\n  setState(button, true)\r\n}\r\n\r\nfunction handlerReleased (button) {\r\n  setState(button, false)\r\n  if (callbacks[button]) {\r\n    callbacks[button](button)\r\n  }\r\n}\r\n\r\nfunction GetInputKeys(inputType) {\r\n  inputType = inputType.toLowerCase()\r\n  return Object.keys(maps[inputType])\r\n}\r\n\r\nfunction GetInputValue(inputType, key) {\r\n  inputType = inputType.toLowerCase()\r\n  return maps[inputType][key]\r\n}\r\n\r\nvar inputState = {}\r\nvar callbacks = {}\r\n\r\nvar enabled = [ 'keyboard', 'gamepad' ]\r\n\r\nfunction setState(button, value) {\r\n  inputState[button] = value\r\n}\r\n\r\nfunction getState(button) {\r\n  if (!listening) {\r\n    return false\r\n  }\r\n  return inputState[button] ? inputState[button] : false\r\n}\r\n\r\nfunction listenerKeyDown(e) {\r\n  if (!listening) {\r\n    return\r\n  }\r\n  let inputs = Object.keys(maps.keyboard)\r\n  for (let i in inputs) {\r\n    if (e.key === maps.keyboard[inputs[i]]) {\r\n      handlerPressed(inputs[i])\r\n    }\r\n  }\r\n}\r\n\r\nfunction listenerKeyUp(e) {\r\n  if (!listening) {\r\n    return\r\n  }\r\n  console.log(e)\r\n  let inputs = Object.keys(maps.keyboard)\r\n  for (let i in inputs) {\r\n    if (e.key === maps.keyboard[inputs[i]]) {\r\n      handlerReleased(inputs[i])\r\n    }\r\n  }\r\n}\r\n\r\nfunction init() {\r\n  inputState = {}\r\n  callbacks = {}\r\n  if (enabled.includes('keyboard')) {\r\n    window.removeEventListener('keydown', listenerKeyDown)\r\n    window.removeEventListener('keyup', listenerKeyUp)\r\n    window.addEventListener('keydown', listenerKeyDown)\r\n    window.addEventListener(\"keyup\", listenerKeyUp)\r\n  }\r\n  if (enabled.includes('gamepad')) {\r\n    gameControl.on('connect', function(gamepad) {\r\n      let inputs = Object.keys(maps.gamepad)\r\n      for (let i in inputs) {\r\n        gamepad.on(maps.gamepad[inputs[i]], () => {\r\n          \r\n        }).after(maps.gamepad[inputs[i]], () => {\r\n          handlerReleased(inputs[i])\r\n        })\r\n      }\r\n    })\r\n  }\r\n  listening = false\r\n}\r\n\r\ninit()\r\n\r\nvar input = {\r\n  listen: () => {\r\n    listening = true\r\n  },\r\n  unlisten: () => {\r\n    listening = false\r\n  },\r\n  released: (button, method) => {\r\n    callbacks[button] = method\r\n  }\r\n}\r\n\r\nexport default input\r\nexport { GetInputKeys, GetInputValue }","import { Pipeline } from './pipeline.js'\r\n\r\nimport characters from \"./characters.json\"\r\n\r\nclass Character {\r\n    constructor(name) {\r\n        // data property holds base class data from json\r\n        try {\r\n            this.data = characters.filter(f => f.name === name)[0]\r\n            this.data.maxHp = this.data.hp\r\n            this.name = this.data.name\r\n        } catch {\r\n            this.data = {}\r\n            console.error(`Could not locate template for ${name}.`)\r\n        }\r\n\r\n        // effectModifiers property holds active effect modifiers.\r\n        this.effectModifiers = {}\r\n\r\n        // Active effect modifiers, evaluated each phase and removed when\r\n        // expired.\r\n        this.effects = []\r\n    }\r\n\r\n    /**\r\n     * Iterate over the effects currently active on this character and\r\n     * do housekeeping (decrement ttl, removing ttl = 0, etc.)\r\n     */\r\n    UpdateEffects() {\r\n        for (let e in this.effects) {\r\n            let effect = this.effects[e]\r\n            if (effect.ttl) {\r\n                effect.ttl--\r\n            }\r\n            if (effect.ttl <= 0) {\r\n                this.RemoveEffectModifier(effect)\r\n            }\r\n        }\r\n        this.effects = this.effects.filter(f => f.ttl > 0)\r\n    }\r\n\r\n    AddEffect(effect) {\r\n        if (effect.ttl) {\r\n            this.effects.push(effect)\r\n        }\r\n        if (effect.attribute !== undefined) {\r\n            this.AddEffectModifier(effect.attribute, effect.amount)\r\n        }\r\n    }\r\n    RemoveEffectModifier(effect) {\r\n        if (effect.attribute !== undefined) {\r\n            this.AddEffect(effect.attribute, effect.amount * -1)\r\n        }\r\n    }\r\n\r\n    AddEffectModifier(attribute, amount) {\r\n        if (this.effectModifiers[attribute] === undefined) {\r\n            this.effectModifiers[attribute] = 0\r\n        }\r\n        this.effectModifiers[attribute] += amount\r\n    }\r\n\r\n    EffectModifier(attribute) {\r\n        if (this.effectModifiers[attribute] !== undefined) {\r\n            return this.effectModifiers[attribute]\r\n        }\r\n        return 0\r\n    }\r\n\r\n    Name() {\r\n        return this.data.name\r\n    }\r\n\r\n    Cost() {\r\n        return this.data.Cost + this.EffectModifier('cost')\r\n    }\r\n\r\n    EquipmentAndAbilities() {\r\n        return this.data.equipAbilities + this.EffectModifier('equipAbilities')\r\n    }\r\n\r\n    GunnerySkill() {\r\n        return this.data.gunnerySkill + this.EffectModifier('gunnerySkill')\r\n    }\r\n\r\n    MeleeSkill() {\r\n        return this.data.meleeSkill + this.EffectModifier('meleeSkill')\r\n    }\r\n\r\n    Speed() {\r\n        return this.data.speed + this.EffectModifier('speed')\r\n    }\r\n\r\n    Hp() {\r\n        return this.data.hp + this.EffectModifier('hp')\r\n    }\r\n\r\n    MaxHp() {\r\n        return this.data.maxHp + this.EffectModifier('maxHp')\r\n    }\r\n}\r\n\r\n export { Character }","import input, { GetInputKeys, GetInputValue } from './input.js'\r\nimport { getContext, drawImage, getImage } from \"./images.js\"\r\nimport menus from './menus.json'\r\nimport { Start } from './main.js'\r\nimport { Character } from './character.js'\r\n\r\nlet imu = null\r\n\r\nlet ctx = null\r\n\r\nvar stars = 16\r\n\r\nvar squad = []\r\n\r\nvar menu = null\r\nvar menuItems = []\r\nvar menuItem = {}\r\nvar currentMenuId = 'Main'\r\nvar currentMenuItem = 'Start'\r\nvar menuMethods = {\r\n    callback_OnRenderStars: (text, replacements) => {\r\n        return [stars.toString()]\r\n    },\r\n    callback_OnRenderHireSquad: (text, replacements) => {\r\n        return [squad.length]\r\n    },\r\n\r\n    callback_OnRenderCharacter: (text, replacements) => {\r\n        let name = text.split(' ')[0].replace('>', '')\r\n        return [(squad.filter(f => f.name === name).length)]\r\n    },\r\n\r\n    callback_HireCharacter: (text) => {\r\n        let name = text.split(' ')[0].replace('>', '')\r\n        let char = new Character(name)\r\n        if (stars - char.Cost() >= 0) {\r\n            squad.push(char)\r\n            stars -= char.Cost()\r\n        }\r\n    },\r\n\r\n    callback_SelectCharacterEquip: (text) => {\r\n        console.log('character equip', text)\r\n    },\r\n\r\n    callback_SetupEquipment: (text) => {\r\n        let menu = menus.filter(f => f.id === 'SetupEquipment')[0]\r\n        let nextIndex = menu.Options.findIndex(f => f.text === 'Next')\r\n        menu.Options = [\r\n            menu.Options[0],\r\n            ...squad.map(m => {\r\n            return {\r\n                text: m.name,\r\n                onSelect: 'callback_SelectCharacterEquip',\r\n                width: '90%'\r\n            }}),\r\n            menu.Options[nextIndex]\r\n        ]\r\n        ChangeMenu('SetupEquipment')\r\n    }\r\n}\r\n\r\nlet menuDx = 0\r\nlet menuDy = 0\r\n\r\nfunction Action(actionId) {\r\n    if (actionId.includes('callback_')) {\r\n        return menuMethods[actionId] ? menuMethods[actionId] : () => {}\r\n    } else if (actionId.includes('menu_')) {\r\n        let action = actionId.split('_')\r\n        ChangeMenu(action[1])\r\n    }\r\n    return () => {}\r\n}\r\n\r\nfunction ChangeMenu(id) {\r\n    input.unlisten()\r\n    currentMenuId = id\r\n    let menu = GetMenu(currentMenuId)\r\n    let menuItems = menu.Options.filter(f => f.onSelect)\r\n    currentMenuItem = menuItems[0].text\r\n    menuItem = menuItems.filter(f => f.text === currentMenuItem)[0]\r\n    input.listen()\r\n}\r\n\r\nfunction GetMenu(id) {\r\n    try {\r\n        return menus.filter(f => f.id === id)[0]\r\n    } catch { return null }\r\n}\r\n\r\nfunction StartMenu(id) {\r\n    input.listen()\r\n\r\n    input.released('moveDown', () => {\r\n        menu = GetMenu(currentMenuId)\r\n        menuItems = menu.Options.filter(f => f.onSelect)\r\n        menuItem = menuItems.filter(f => f.text === currentMenuItem)[0]\r\n        let index = menuItems.findIndex(f => f.text === currentMenuItem)\r\n        index++\r\n        if (index >= menuItems.length) {\r\n            index = 0\r\n        }\r\n        currentMenuItem = menuItems[index].text\r\n    })\r\n    input.released('moveUp', () => {\r\n        menu = GetMenu(currentMenuId)\r\n        menuItems = menu.Options.filter(f => f.onSelect)\r\n        menuItem = menuItems.filter(f => f.text === currentMenuItem)[0]\r\n        let index = menuItems.findIndex(f => f.text === currentMenuItem)\r\n        index--\r\n        if (index < 0) {\r\n            index = menuItems.length - 1\r\n        }\r\n        currentMenuItem = menuItems[index].text\r\n    })\r\n    input.released('attack', () => {\r\n        menu = GetMenu(currentMenuId)\r\n        menuItems = menu.Options.filter(f => f.onSelect)\r\n        menuItem = menuItems.filter(f => f.text === currentMenuItem)[0]    \r\n        if (menuItem.onSelect) {\r\n            Action(menuItem.onSelect)(menuItem.text)\r\n        }\r\n    })\r\n}\r\n\r\nfunction drawFrame(delta) {\r\n    if (!ctx) {\r\n        ctx = getContext()\r\n    }\r\n    ctx.clearRect(0, 0, 320, 200)\r\n\r\n    drawUI(delta)\r\n}\r\n\r\nfunction OnRender(text, onRender) {\r\n    let arr = text.split(/{[0-9]}/)\r\n    let replacements = []\r\n    for (let r in arr) {\r\n        replacements.push(`{${r}}`)\r\n    }\r\n    let values = Action(onRender)(text, arr)\r\n    for (let v in values) {\r\n        text = text.replace(replacements[v], values[v])\r\n    }\r\n    return text\r\n}\r\n\r\nfunction drawUI(delta) {\r\n    if (!imu) {\r\n        imu = new imui.ImUI(ctx.canvas)\r\n        imu.font = font\r\n        \r\n        imu.onUpdate = (ui) => {\r\n            //ui.Element({ id: 'imgGamename', type: 'Image', x: 10, y: 10, image: getImage('title') })\r\n            let menu = GetMenu(currentMenuId)\r\n            let menuItems = menu.Options\r\n            imu.RemoveElements()\r\n            let dy = menuDy + 30\r\n            for (let i in menuItems) {\r\n                let item = menuItems[i].text\r\n                let menuItem = menuItems[i]\r\n                let colr = item === currentMenuItem ? menu.Style.SelectColor : menuItem.onSelect ? menu.Style.SelectableColor : menu.Style.Color\r\n                let txt = `${currentMenuItem === item ? '>' : ' '}${item}${currentMenuItem === item ? '<' : ' ' }`\r\n                if (txt.includes('{') && txt.includes('}') && menuItem.onRender) {\r\n                    txt = OnRender(txt, menuItem.onRender)\r\n                }\r\n                ui.Element({ id: 'lblMenu' + currentMenuId + item, text: txt, rect: { x: menuDx, y: dy, w: 64, h: 8 }, color: colr, highlight: colr, bgcolor: '#cccccc00' })\r\n                dy += 12\r\n            }\r\n        }\r\n    }\r\n    imu.Draw()\r\n}\r\n\r\nexport { drawFrame, StartMenu }","import images from './images.js'\r\nimport sfx from './sfx.js'\r\nimport music from './music.js'\r\nimport sprites from './sprites.js'\r\nimport { setContext, loadAllImages } from './images.js'\r\nimport { drawFrame as drawMain } from './mainScene.js'\r\nimport { drawFrame as drawMainMenu, StartMenu } from './menuScene.js'\r\nimport { set, setDictionary } from './grammar.js'\r\nimport input from './input.js'\r\n\r\nvar dateNow = Date.now()\r\nvar dateThen = Date.now()\r\n\r\nvar targetDelta = 16 // Roughly 60fps by default\r\n\r\nvar currentScene = 'mainMenu'\r\n\r\nfunction setTargetFrameRate(target) {\r\n    targetDelta = parseInt(1000 / target) // Number of ms divided by target fps\r\n}\r\n\r\nfunction requestAnimationFrame() {\r\n    dateNow = Date.now()\r\n    let delta = dateNow - dateThen\r\n    if (delta >= targetDelta) {\r\n        drawFrame(delta)\r\n        dateThen = dateNow\r\n    }\r\n    window.requestAnimationFrame(requestAnimationFrame)\r\n}\r\n\r\n/**\r\n * Draws the animation frame.\r\n * @param {number} delta Number of ms since last frame.\r\n */\r\nfunction drawFrame(delta) {\r\n    if (currentScene === 'mainMenu') {\r\n        drawMainMenu(delta)\r\n    } else if (currentScene === 'main') {\r\n        drawMain(delta)\r\n    }\r\n}\r\n\r\nasync function StartMainMenu() {\r\n    await loadAllImages()\r\n\r\n    let canvas = document.getElementById('maincanvas')\r\n    let ratio = canvas.width / canvas.height\r\n    canvas.style.height = window.innerHeight + 'px'\r\n    canvas.style.width = window.innerHeight * ratio + 'px'\r\n    window.addEventListener('resize', () => {\r\n        canvas.style.height = window.innerHeight + 'px'\r\n        canvas.style.width = window.innerHeight * ratio + 'px'\r\n      })\r\n\r\n    setTargetFrameRate(60)\r\n    setContext(canvas.getContext('2d'))\r\n\r\n    StartMenu()\r\n\r\n    window.requestAnimationFrame(requestAnimationFrame)\r\n}\r\n\r\nasync function Start() {\r\n\r\n    input.unlisten()\r\n   \r\n    // Init(CreatePlayer('@', digger.Floors()))\r\n    // Player().slots = [melee, ranged, area]\r\n    // AddTemples(3)\r\n    currentScene = 'main'\r\n}\r\n\r\nexport { Start, StartMainMenu }"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ctx","getContext","imu","tooltip","listening","handlerReleased","button","setState","callbacks","inputState","enabled","listenerKeyDown","e","inputs","keys","i","listenerKeyUp","console","log","includes","window","removeEventListener","addEventListener","gameControl","on","gamepad","after","listen","unlisten","released","method","Character","constructor","name","this","data","f","maxHp","hp","error","effectModifiers","effects","UpdateEffects","effect","ttl","RemoveEffectModifier","filter","AddEffect","push","undefined","attribute","AddEffectModifier","amount","EffectModifier","Name","Cost","EquipmentAndAbilities","equipAbilities","GunnerySkill","gunnerySkill","MeleeSkill","meleeSkill","Speed","speed","Hp","MaxHp","stars","squad","menu","menuItems","menuItem","currentMenuId","currentMenuItem","menuMethods","callback_OnRenderStars","text","replacements","toString","callback_OnRenderHireSquad","length","callback_OnRenderCharacter","split","replace","callback_HireCharacter","char","callback_SelectCharacterEquip","callback_SetupEquipment","id","nextIndex","Options","findIndex","map","m","onSelect","width","ChangeMenu","menuDx","menuDy","Action","actionId","GetMenu","OnRender","onRender","arr","r","values","v","dateNow","Date","now","dateThen","targetDelta","currentScene","requestAnimationFrame","clearRect","imui","ImUI","canvas","font","onUpdate","ui","RemoveElements","dy","item","colr","Style","SelectColor","SelectableColor","Color","txt","Element","rect","x","y","w","h","color","highlight","bgcolor","Draw","async","StartMainMenu","promises","image","Promise","resolve","reject","loadImage","filename","img","Image","onload","onerror","src","then","catch","allSettled","loadAllImages","document","getElementById","ratio","height","context","style","innerHeight","parseInt","index","Start"],"sourceRoot":""}